<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Leverage Calculator</title>
    <style>
        /* 스타일은 동일 */
    </style>
</head>
<body>
    <div class="container">
        <h1>☑️LVG. Check</h1>

        <div class="row">
            <label for="position">Position:</label>
            <select id="position">
                <option value="long">📈Long</option>
                <option value="short">📉Short</option>
            </select>
        </div>

        <div class="row">
            <label for="entryPrice">Entry Price:</label>
            <input type="text" id="entryPrice" placeholder="Enter entry price" 
                   oninput="formatInput(this)" 
                   onblur="formatOnBlur(this)" 
                   inputmode="decimal">
        </div>

        <div class="row">
            <label for="lossCutPrice">Loss Cut Price:</label>
            <input type="text" id="lossCutPrice" placeholder="Enter loss cut price" 
                   oninput="formatInput(this)" 
                   onblur="formatOnBlur(this)" 
                   inputmode="decimal">
        </div>

        <div class="row">
            <label for="coverPercent">Coverable Percentage(%):</label>
            <select id="coverPercent">
                <option value="5">5%</option>
                <option value="10">10%</option>
                <option value="15">15%</option>
                <option value="20" selected>20%</option>
                <option value="25">25%</option>
                <option value="30">30%</option>
                <option value="40">40%</option>
                <option value="50">50%</option>
            </select>
        </div>

        <button onclick="calculateMaintenanceTP()">Calculate</button>

        <div id="result">Result will appear here.</div>
    </div>

    <script>
        function formatInput(input) {
            let value = input.value.replace(/,/g, ''); // ',' 제거
            if (isNaN(value)) {
                return; // 숫자가 아니면 포맷하지 않음
            }
            input.dataset.rawValue = value; // 입력값을 별도로 저장
        }

        function formatOnBlur(input) {
            let value = input.dataset.rawValue || input.value.replace(/,/g, '');
            if (!isNaN(value) && value.trim() !== '') {
                input.value = Number(value).toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                });
            }
        }

        function parseFormattedNumber(value) {
            return parseFloat(value.replace(/,/g, '')); 
        }

        function calculateMaintenanceTP() {
            const position = document.getElementById("position").value;
            const entryPrice = parseFormattedNumber(document.getElementById("entryPrice").value);
            const lossCutPrice = parseFormattedNumber(document.getElementById("lossCutPrice").value);
            const coverPercent = parseFloat(document.getElementById("coverPercent").value);

            const resultElement = document.getElementById("result");

            if (isNaN(entryPrice) || isNaN(lossCutPrice)) {
                resultElement.textContent = "Please enter both entry price and loss cut price.";
                resultElement.style.color = "red";
                return;
            }

            if ((position === "long" && lossCutPrice >= entryPrice) ||
                (position === "short" && lossCutPrice <= entryPrice)) {
                resultElement.textContent = position === "long" 
                    ? "For Long Position, Loss Cut Price must be LOWER than Entry Price."
                    : "For Short Position, Loss Cut Price must be HIGHER than Entry Price.";
                resultElement.style.color = "red";
                return;
            }

            const riskAmount = Math.abs(entryPrice - lossCutPrice);
            const lossPercent = Math.abs((entryPrice - lossCutPrice) / entryPrice) * 100;
            const leverage = coverPercent / lossPercent;

            let halfTakeProfit = position === "long" 
                ? entryPrice + riskAmount 
                : entryPrice - riskAmount;

            resultElement.innerHTML = `
                <div>Leverage: <strong>${leverage.toFixed(2)}x</strong></div>
                <div>Half TP: <strong>${halfTakeProfit.toFixed(2).toLocaleString()}</strong></div>
            `;
            resultElement.style.color = "#333";
        }
    </script>
</body>
</html>