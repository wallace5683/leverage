<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>생일수 계산기</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f5f5;
            --text-color: #333;
            --border-color: #dee2e6;
            --error-color: #dc3545;
            --success-color: #28a745;
        }

        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .card-result {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h3 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            min-width: 80px;
            background-color: white;
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .card-info {
            margin-top: 10px;
        }

        .card-name {
            color: var(--primary-color);
            font-weight: bold;
            margin: 5px 0;
        }

        .card-meaning {
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
            line-height: 1.4;
        }

        .date-display {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 600px) {
            .card-result {
                grid-template-columns: 1fr;
            }

            .date-inputs {
                flex-direction: column;
                align-items: stretch;
            }

            select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>생일수 계산기</h1>
        <div id="errorContainer" class="error-message" role="alert"></div>

        <div class="input-group">
            <div class="radio-group">
                <label>
                    <input type="radio" name="calendarType" value="solar" checked>
                    양력
                </label>
                <label>
                    <input type="radio" name="calendarType" value="lunar">
                    음력
                </label>
            </div>

            <div class="date-inputs">
                <select id="year" aria-label="년도 선택"></select>
                <select id="month" aria-label="월 선택"></select>
                <select id="day" aria-label="일 선택"></select>
            </div>
        </div>

        <div class="card-result">
            <div class="card">
                <h3>양력 카드</h3>
                <div class="date-display" id="solarDate">양력: -</div>
                <div id="solarCardInfo" class="card-info"></div>
            </div>
            <div class="card">
                <h3>음력 카드</h3>
                <div class="date-display" id="lunarDate">음력: -</div>
                <div id="lunarCardInfo" class="card-info"></div>
            </div>
            <div class="card">
                <h3>그림자 카드</h3>
                <div id="shadowCardInfo" class="card-info"></div>
            </div>
            <div class="card">
                <h3>소울 카드</h3>
                <div id="soulCardInfo" class="card-info"></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/solarlunar@1.0.7/index.js"></script>
    <script>
        const yearSelect = document.getElementById('year');
        const monthSelect = document.getElementById('month');
        const daySelect = document.getElementById('day');
        const currentYear = new Date().getFullYear();

        function initializeDateSelects() {
            yearSelect.innerHTML = '<option value="">년도</option>';
            for (let y = currentYear; y >= 1900; y--) { // 년도를 내림차순으로 변경
                yearSelect.innerHTML += `<option value="${y}">${y}년</option>`;
            }

            monthSelect.innerHTML = '<option value="">월</option>';
            for (let m = 1; m <= 12; m++) {
                monthSelect.innerHTML += `<option value="${m}">${m}월</option>`;
            }

            updateDays();
        }

        function updateDays() {
            const year = parseInt(yearSelect.value) || currentYear;
            const month = parseInt(monthSelect.value) || 1;
            const lastDay = new Date(year, month, 0).getDate();

            daySelect.innerHTML = '<option value="">일</option>';
            for (let d = 1; d <= lastDay; d++) {
                daySelect.innerHTML += `<option value="${d}">${d}일</option>`;
            }

            if (parseInt(daySelect.value) > lastDay) {
                daySelect.value = '';
            }
        }

        function validateInputs() {
            if (!yearSelect.value || !monthSelect.value || !daySelect.value) {
                document.getElementById('errorContainer').textContent = '모든 필드를 선택해주세요.';
                return false;
            }
            document.getElementById('errorContainer').textContent = '';
            return true;
        }

        function calculateCards() {
            if (!validateInputs()) return;

            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const day = parseInt(daySelect.value);
            const isSolar = document.querySelector('input[name="calendarType"]:checked').value === 'solar';

            let solarDate, lunarDate;
            try {
                if (isSolar) {
                    lunarDate = solarlunar.solar2lunar(year, month, day);
                    solarDate = { cYear: year, cMonth: month, cDay: day };
                } else {
                    solarDate = solarlunar.lunar2solar(year, month, day, false);
                    lunarDate = { lYear: year, lMonth: month, lDay: day };
                }

                document.getElementById('solarDate').textContent = `양력: ${solarDate.cYear}년 ${solarDate.cMonth}월 ${solarDate.cDay}일`;
                document.getElementById('lunarDate').textContent = `음력: ${lunarDate.lYear}년 ${lunarDate.lMonth}월 ${lunarDate.lDay}일`;

                const solarSum = calculateSingleDigit(solarDate.cYear + solarDate.cMonth + solarDate.cDay);
                displayCardInfo('solarCardInfo', solarSum);
                displayCardInfo('lunarCardInfo', calculateSingleDigit(lunarDate.lYear + lunarDate.lMonth + lunarDate.lDay));
                displayCardInfo('shadowCardInfo', 22 - solarSum);
                displayCardInfo('soulCardInfo', solarSum > 21 ? solarSum - 22 : null);
            } catch (error) {
                document.getElementById('errorContainer').textContent = '선택한 날짜가 유효하지 않습니다. 다시 확인해주세요.';
            }
        }

        function calculateSingleDigit(num) {
            return 1 + ((num - 1) % 9);
        }

        function displayCardInfo(id, cardNumber) {
            const tarotCards = ["광대(The Fool)", "마법사(The Magician)", "여사제(The High Priestess)",
                                "여제(The Empress)", "황제(The Emperor)", "교황(The Hierophant)",
                                "연인(The Lovers)", "전차(The Chariot)", "힘(Strength)", "은둔자(The Hermit)",
                                "운명의 수레바퀴(The Wheel of Fortune)", "정의(Justice)", "매달린 사람(The Hanged Man)",
                                "죽음(Death)", "절제(Temperance)", "악마(The Devil)", "탑(The Tower)",
                                "별(The Star)", "달(The Moon)", "태양(The Sun)", "심판(Judgement)", "세계(The World)"];

            const element = document.getElementById(id);
            element.innerHTML = cardNumber !== null ? `<div class="card-name">${cardNumber}번 카드: ${tarotCards[cardNumber]}</div>`
                                                    : '<div class="card-meaning">해당없음</div>';
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeDateSelects();
            yearSelect.addEventListener('change', () => { updateDays(); calculateCards(); });
            monthSelect.addEventListener('change', () => { updateDays(); calculateCards(); });
            daySelect.addEventListener('change', calculateCards);
            document.querySelectorAll('input[name="calendarType"]').forEach(radio => radio.addEventListener('change', calculateCards));
        });
    </script>
</body>
</html>
