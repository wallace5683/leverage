<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>타로 생일카드 계산기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        input, button, select {
            margin: 10px 0;
            padding: 5px;
        }
        #result {
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/solarlunar@2.0.7/dist/solarlunar.min.js"></script>
</head>
<body>
    <h1>타로 생일카드 계산기</h1>
    <select id="calendarType">
        <option value="solar">양력</option>
        <option value="lunar">음력</option>
    </select>
    <input type="number" id="year" placeholder="년도 (예: 1987)">
    <input type="number" id="month" placeholder="월 (1-12)">
    <input type="number" id="day" placeholder="일 (1-31)">
    <button onclick="calculateCards()">계산하기</button>
    <div id="result"></div>

    <script>
        function calculateCards() {
            try {
                const calendarType = document.getElementById('calendarType').value;
                const year = parseInt(document.getElementById('year').value);
                const month = parseInt(document.getElementById('month').value);
                const day = parseInt(document.getElementById('day').value);

                if (isNaN(year) || isNaN(month) || isNaN(day)) {
                    throw new Error("올바른 날짜를 입력해주세요.");
                }

                let solarDate, lunarDate;

                if (calendarType === 'solar') {
                    solarDate = { year, month, day };
                    lunarDate = solarlunar.solar2lunar(year, month, day);
                } else {
                    lunarDate = { year, month, day };
                    solarDate = solarlunar.lunar2solar(year, month, day);
                }

                const solarSum = solarDate.year + solarDate.month + solarDate.day;
                const lunarSum = lunarDate.year + lunarDate.month + lunarDate.day;

                const solarFinalSum = getFinalCard(sumDigits(solarSum));
                const lunarFinalSum = getFinalCard(sumDigits(lunarSum));
                
                const solarCard = solarFinalSum;
                const lunarCard = lunarFinalSum;
                const shadowCard = getFinalCard(22 - solarCard);
                const soulCard = getSoulCard(sumDigits(solarSum));

                const result = `
                    <h2>결과</h2>
                    <p>양력 날짜: ${solarDate.year}년 ${solarDate.month}월 ${solarDate.day}일</p>
                    <p>음력 날짜: ${lunarDate.year}년 ${lunarDate.month}월 ${lunarDate.day}일</p>
                    <p>양력카드: ${solarCard}번 ${getCardName(solarCard)}</p>
                    <p>음력카드: ${lunarCard}번 ${getCardName(lunarCard)}</p>
                    <p>그림자카드: ${shadowCard}번 ${getCardName(shadowCard)}</p>
                    ${soulCard ? `<p>소울카드: ${soulCard}번 ${getCardName(soulCard)}</p>` : '<p>소울카드: 해당 없음</p>'}
                `;

                document.getElementById('result').innerHTML = result;
            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">오류: ${error.message}</p>`;
            }
        }

        function sumDigits(num) {
            return num.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
        }

        function getFinalCard(num) {
            while (num > 21) {
                num = sumDigits(num);
            }
            return num;
        }

        function getSoulCard(num) {
            if (num <= 21) return null;
            return getFinalCard(num - 22);
        }

        function getCardName(num) {
            const cards = [
                "바보", "마법사", "여사제", "여왕", "황제", "교황", "연인",
                "전차", "힘", "은둔자", "운명의 수레바퀴", "정의", "매달린 사람",
                "죽음", "절제", "악마", "탑", "별", "달", "태양", "심판", "세계"
            ];
            return cards[num];
        }
    </script>
</body>
</html>
